<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Volleyball Scoreboard</title>

    <style>
        html, body {
            margin:0; padding:0; height:100%; font-family:Arial,sans-serif;
            background:black; color:white; overflow:hidden;
        }

        .container {
            display:flex;
            height:100vh;
            width:100vw;
            transition: all 0.5s ease;
        }

        .container.flipped {
            flex-direction: row-reverse;
        }

        .team {
            flex:1;
            display:flex;
            flex-direction:column;
            justify-content:center;
            align-items:center;
            position:relative;
            cursor:pointer;
        }

        .teamA { background:#c62828; }
        .teamB { background:#1565c0; }

        .score {
            font-weight:900;
            text-align:center;
            user-select:none;
            line-height:1;
        }

        .top-button {
            width:100%;
            display:flex;
            justify-content:center;
            position:absolute;
            top:2%;
            z-index:10;
        }

        .sub-button {
            font-size:12vh;
            padding:2vh 6vw;
            border:none;
            border-radius:1vw;
            background:rgba(255,255,255,0.25);
            color:white;
            cursor:pointer;
        }

        .sub-button:hover { background:rgba(255,255,255,0.5); }

        .reset-container {
            position:absolute;
            bottom:2%;
            left:50%;
            transform:translateX(-50%);
            display:flex;
            gap:1vw;
        }

        .reset-container button {
            font-size:3vh;
            padding:1vh 3vw;
            background:#ff9800;
            color:white;
            border:none;
            border-radius:1vw;
            cursor:pointer;
        }

        #flip {
            font-size:4vh;
            padding:2.5vh 6vw;
            background:#4caf50;
        }
    </style>
</head>
<body>

<div class="container" id="mainContainer">
    <div class="team teamA" id="containerA">
        <div class="top-button">
            <button class="sub-button" id="subA">-1</button>
        </div>
        <div id="scoreA" class="score">0</div>
    </div>

    <div class="team teamB" id="containerB">
        <div class="top-button">
            <button class="sub-button" id="subB">-1</button>
        </div>
        <div id="scoreB" class="score">0</div>
    </div>
</div>

<div class="reset-container">
    <button id="flip">Flip Sides</button>
    <button id="reset">Reset</button>
</div>

<script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

    const supabaseUrl = 'https://ygwqbzdhlpvhpuueyyov.supabase.co';
    const supabaseKey = 'YOUR_KEY';
    const supabase = createClient(supabaseUrl, supabaseKey);

    const gameId = "volleyball-game-1";

    let scoreA = 0;
    let scoreB = 0;

    const elA = document.getElementById("scoreA");
    const elB = document.getElementById("scoreB");
    const container = document.getElementById("mainContainer");

    // --------------------------------------------------------
    //  PERFECT FITTING FONT FUNCTION (Width + Height)
    // --------------------------------------------------------
    function resizeScore(el) {
        let parent = el.parentElement;
        let size = parent.clientHeight * 0.8;
        el.style.fontSize = size + "px";

        while (
            (el.scrollWidth > parent.clientWidth - 40 ||
                el.scrollHeight > parent.clientHeight - 40) &&
            size > 10
            ) {
            size -= 2;
            el.style.fontSize = size + "px";
        }
    }

    function repaintScores() {
        resizeScore(elA);
        resizeScore(elB);
    }

    window.addEventListener("resize", repaintScores);

    // --------------------------------------------------------
    //  Display update
    // --------------------------------------------------------
    function updateDisplay() {
        elA.innerText = scoreA;
        elB.innerText = scoreB;
        repaintScores();
    }

    // --------------------------------------------------------
    //  Supabase syncing
    // --------------------------------------------------------
    async function getScores() {
        const { data } = await supabase
            .from("games")
            .select("*")
            .eq("id", gameId)
            .single();

        if (data) {
            scoreA = data.scorea;
            scoreB = data.scoreb;
            updateDisplay();
        }
    }

    async function setScores() {
        await supabase
            .from("games")
            .update({ scorea: scoreA, scoreb: scoreB })
            .eq("id", gameId);
    }

    supabase
        .channel("public:games")
        .on(
            "postgres_changes",
            {
                event: "*",
                schema: "public",
                table: "games",
                filter: `id=eq.${gameId}`
            },
            (payload) => {
                scoreA = payload.new.scorea;
                scoreB = payload.new.scoreb;
                updateDisplay();
            }
        )
        .subscribe();

    // --------------------------------------------------------
    //  Buttons + Interaction
    // --------------------------------------------------------
    document.getElementById("containerA").onclick = () => { scoreA++; setScores(); updateDisplay(); };
    document.getElementById("containerB").onclick = () => { scoreB++; setScores(); updateDisplay(); };

    document.getElementById("subA").onclick = (e) => { e.stopPropagation(); if(scoreA>0) scoreA--; setScores(); updateDisplay(); };
    document.getElementById("subB").onclick = (e) => { e.stopPropagation(); if(scoreB>0) scoreB--; setScores(); updateDisplay(); };

    document.getElementById("reset").onclick = async () => {
        if (confirm("Reset both scores?")) {
            scoreA = 0; scoreB = 0;
            setScores();
            updateDisplay();
        }
    };

    document.getElementById("flip").onclick = () => {
        container.classList.toggle("flipped");
    };

    // Initial load
    await getScores();
    repaintScores();
</script>

</body>
</html>
