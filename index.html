<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Volleyball Scoreboard</title>
<style>
  html, body { margin:0; padding:0; height:100%; font-family:Arial,sans-serif; background:black; color:white; overflow:hidden; }
  .container { display:flex; height:100vh; position:relative; }
  .team { flex:1; display:flex; flex-direction:column; justify-content:center; align-items:center; position:relative; }
  .teamA { background:#c62828; }
  .teamB { background:#1565c0; }
  .score { font-size:45vh; font-weight:900; text-align:center; user-select:none; }

  /* --- Buttons at top --- */
  .buttons-top {
    position:absolute;
    top:1vh;  /* distance from top */
    width:100%;
    display:flex;
    justify-content:space-around;
    gap:2vw;
    z-index:10;
  }
  .buttons-top button {
    font-size:4vh;
    padding:1vh 2vw;
    border:none;
    border-radius:1vw;
    color:white;
    background:rgba(255,255,255,0.25);
    cursor:pointer;
  }
  .buttons-top button:hover { background:rgba(255,255,255,0.5); }

  .reset-container { position:absolute; bottom:2%; left:50%; transform:translateX(-50%); }
  .reset-container button { font-size:3vh; padding:1vh 3vw; background:#ff9800; color:white; border:none; border-radius:1vw; }
</style>
</head>
<body>

<!-- Buttons at top -->
<div class="buttons-top">
  <button id="addA">A +1</button>
  <button id="subA">A -1</button>
  <button id="addB">B +1</button>
  <button id="subB">B -1</button>
</div>

<div class="container">
  <div class="team teamA">
      <div id="scoreA" class="score">0</div>
  </div>
  <div class="team teamB">
      <div id="scoreB" class="score">0</div>
  </div>
</div>

<div class="reset-container">
  <button id="reset">Reset</button>
</div>

<script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

  // --- Supabase config ---
  const supabaseUrl = 'https://ygwqbzdhlpvhpuueyyov.supabase.co';
  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inlnd3FiemRobHB2aHB1dWV5eW92Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEzOTQ2NDUsImV4cCI6MjA3Njk3MDY0NX0._N7Pe1ugrzj83SNl4hUlqqIYQeN5Xed2G9SWftVw8-s';

  const supabase = createClient(supabaseUrl, supabaseKey);

  const gameId = 'volleyball-game-1';
  let scoreA = 0, scoreB = 0;

  const elA = document.getElementById('scoreA');
  const elB = document.getElementById('scoreB');

  // --- Update display ---
  function updateDisplay() {
    elA.innerText = scoreA;
    elB.innerText = scoreB;
  }

  // --- Fetch initial scores ---
  async function getScores() {
    const { data, error } = await supabase.from('games').select('*').eq('id', gameId).single();
    if (error) { console.error('Error fetching scores:', error); return; }
    if (data) {
      scoreA = data.scorea;
      scoreB = data.scoreb;
      updateDisplay();
    }
  }

  // --- Update scores in Supabase ---
  async function setScores() {
    const { error } = await supabase.from('games').update({ scorea: scoreA, scoreb: scoreB }).eq('id', gameId);
    if (error) console.error('Error updating scores:', error);
  }

  // --- Realtime subscription ---
  supabase.channel('public:games')
    .on('postgres_changes', { event: '*', schema: 'public', table: 'games', filter: `id=eq.${gameId}` }, (payload) => {
      const newData = payload.new;
      scoreA = newData.scorea;
      scoreB = newData.scoreb;
      updateDisplay();
    })
    .subscribe();

  // --- Button actions ---
  const add = async (team) => {
    if (team === 'A') scoreA++; else scoreB++;
    updateDisplay();
    await setScores();
  };

  const subtract = async (team) => {
    if (team === 'A' && scoreA > 0) scoreA--;
    else if (team === 'B' && scoreB > 0) scoreB--;
    updateDisplay();
    await setScores();
  };

  const resetScores = async () => {
    if (confirm('Reset both scores?')) {
      scoreA = 0;
      scoreB = 0;
      updateDisplay();
      await setScores();
    }
  };

  // --- Attach event listeners ---
  document.getElementById('addA').onclick = () => add('A');
  document.getElementById('subA').onclick = () => subtract('A');
  document.getElementById('addB').onclick = () => add('B');
  document.getElementById('subB').onclick = () => subtract('B');
  document.getElementById('reset').onclick = () => resetScores();

  // --- Initial load ---
  await getScores();
</script>
</body>
</html>
